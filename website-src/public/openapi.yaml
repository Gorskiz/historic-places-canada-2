openapi: 3.1.0
info:
  title: Historic Places Canada API
  version: 1.0.0
  description: |
    # Historic Places Canada Open Data API

    A free, open-access API providing comprehensive data about Canada's nationally recognized historic places. This API includes information about over 11,000 historic sites across Canada with geographic coordinates, images, descriptions, and metadata.

    ## Features
    - **Bilingual Support**: All content available in English and French (use `lang` parameter)
    - **Rich Metadata**: Includes recognition dates, architectural styles, themes, and more
    - **Geographic Data**: Latitude/longitude coordinates for mapping
    - **Images**: High-quality historic photographs via R2 storage
    - **Full-Text Search**: Search across names, descriptions, architects, and more
    - **Advanced Filters**: Filter by province, type, theme, date range, and more

    ## Rate Limiting
    - **Anonymous Users**: 100 requests per minute per IP address
    - Rate limit headers included in all responses:
      - `X-RateLimit-Limit`: Maximum requests per window
      - `X-RateLimit-Remaining`: Requests remaining in current window
      - `X-RateLimit-Reset`: Unix timestamp when the limit resets
    - When limit exceeded, returns `429 Too Many Requests` with `Retry-After` header

    ## Data Attribution
    Data sourced from Parks Canada's Historic Places database. Please attribute:
    > "Data from Historic Places Canada, Parks Canada"

    ## Support
    For issues or questions, visit: https://github.com/yourusername/historic-canada-api

  contact:
    name: API Support
    url: https://historicplaces2.workers.dev
  license:
    name: Open Data
    url: https://open.canada.ca/en/open-government-licence-canada

servers:
  - url: https://historicplaces2.workers.dev
    description: Production API
  - url: http://localhost:8787
    description: Local development

tags:
  - name: Places
    description: Retrieve historic place records
  - name: Search
    description: Full-text search with filters
  - name: Geography
    description: Map data and geographic queries
  - name: Metadata
    description: Database statistics and filter options

paths:
  /api/places:
    get:
      summary: List historic places
      description: |
        Retrieve a paginated list of historic places with optional filtering by province and recognition type.

        ## Example Usage

        **JavaScript (Fetch API)**:
        ```javascript
        const response = await fetch('https://historicplaces2.workers.dev/api/places?lang=en&province=Ontario&limit=20');
        const data = await response.json();
        console.log(data.places);
        ```

        **Python (requests)**:
        ```python
        import requests
        response = requests.get('https://historicplaces2.workers.dev/api/places', params={
            'lang': 'en',
            'province': 'Ontario',
            'limit': 20
        })
        data = response.json()
        print(data['places'])
        ```

        **cURL**:
        ```bash
        curl "https://historicplaces2.workers.dev/api/places?lang=en&province=Ontario&limit=20"
        ```
      tags:
        - Places
      parameters:
        - name: lang
          in: query
          description: Language for content (en or fr)
          required: false
          schema:
            type: string
            enum: [en, fr]
            default: en
        - name: province
          in: query
          description: Filter by Canadian province or territory
          required: false
          schema:
            type: string
            example: Ontario
        - name: type
          in: query
          description: Filter by recognition type
          required: false
          schema:
            type: string
            example: National Historic Site of Canada
        - name: random
          in: query
          description: Return results in random order
          required: false
          schema:
            type: boolean
            default: false
        - name: limit
          in: query
          description: Number of results to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
        - name: offset
          in: query
          description: Number of results to skip (for pagination)
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Successful response with list of places
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
              description: Maximum requests per minute
            X-RateLimit-Remaining:
              schema:
                type: integer
              description: Requests remaining in current window
            X-RateLimit-Reset:
              schema:
                type: integer
              description: Unix timestamp when rate limit resets
          content:
            application/json:
              schema:
                type: object
                properties:
                  places:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlaceSummary'
                  count:
                    type: integer
                    description: Number of places in this response
              example:
                places:
                  - id: 123
                    name: "Parliament Hill"
                    province: "Ontario"
                    municipality: "Ottawa"
                    latitude: 45.4236
                    longitude: -75.7009
                    recognition_type: "National Historic Site of Canada"
                    jurisdiction: "Federal"
                    primary_image: "https://images.example.com/parliament.jpg"
                count: 1
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/places/{id}:
    get:
      summary: Get specific place details
      description: |
        Retrieve detailed information about a specific historic place, including all associated images.

        ## Example Usage

        **JavaScript**:
        ```javascript
        const response = await fetch('https://historicplaces2.workers.dev/api/places/123?lang=en');
        const data = await response.json();
        console.log(data.place.name);
        console.log(data.images);
        ```

        **Python**:
        ```python
        import requests
        response = requests.get('https://historicplaces2.workers.dev/api/places/123', params={'lang': 'en'})
        data = response.json()
        print(data['place']['name'])
        print(data['images'])
        ```

        **cURL**:
        ```bash
        curl "https://historicplaces2.workers.dev/api/places/123?lang=en"
        ```
      tags:
        - Places
      parameters:
        - name: id
          in: path
          description: Unique place identifier
          required: true
          schema:
            type: integer
        - name: lang
          in: query
          description: Language for content (en or fr)
          required: false
          schema:
            type: string
            enum: [en, fr]
            default: en
      responses:
        '200':
          description: Successful response with place details
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
            X-RateLimit-Remaining:
              schema:
                type: integer
            X-RateLimit-Reset:
              schema:
                type: integer
          content:
            application/json:
              schema:
                type: object
                properties:
                  place:
                    $ref: '#/components/schemas/PlaceDetail'
                  images:
                    type: array
                    items:
                      $ref: '#/components/schemas/Image'
        '404':
          description: Place not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/search:
    get:
      summary: Full-text search with filters
      description: |
        Search historic places by text query with advanced filtering and sorting options.

        ## Example Usage

        **JavaScript**:
        ```javascript
        const response = await fetch('https://historicplaces2.workers.dev/api/search?q=castle&province=Quebec&limit=10');
        const data = await response.json();
        console.log(data.results);
        console.log(`Found ${data.total} total matches`);
        ```

        **Python**:
        ```python
        import requests
        response = requests.get('https://historicplaces2.workers.dev/api/search', params={
            'q': 'castle',
            'province': 'Quebec',
            'limit': 10
        })
        data = response.json()
        print(f"Found {data['total']} total matches")
        ```

        **cURL**:
        ```bash
        curl "https://historicplaces2.workers.dev/api/search?q=castle&province=Quebec&limit=10"
        ```
      tags:
        - Search
      parameters:
        - name: q
          in: query
          description: Search query (searches name, description, municipality, architect)
          required: false
          schema:
            type: string
            minLength: 2
        - name: lang
          in: query
          description: Language for content
          required: false
          schema:
            type: string
            enum: [en, fr]
            default: en
        - name: province
          in: query
          description: Filter by province
          required: false
          schema:
            type: string
        - name: municipality
          in: query
          description: Filter by municipality (partial match)
          required: false
          schema:
            type: string
        - name: type
          in: query
          description: Filter by recognition type
          required: false
          schema:
            type: string
        - name: jurisdiction
          in: query
          description: Filter by jurisdiction (Federal, Provincial, Municipal, etc.)
          required: false
          schema:
            type: string
        - name: theme
          in: query
          description: Filter by historical theme
          required: false
          schema:
            type: string
        - name: architect
          in: query
          description: Filter by architect name (partial match)
          required: false
          schema:
            type: string
        - name: min_year
          in: query
          description: Minimum recognition year
          required: false
          schema:
            type: integer
            minimum: 1800
            maximum: 2100
        - name: max_year
          in: query
          description: Maximum recognition year
          required: false
          schema:
            type: integer
            minimum: 1800
            maximum: 2100
        - name: sort
          in: query
          description: Sort order for results
          required: false
          schema:
            type: string
            enum: [name_asc, name_desc, newest, oldest, random]
            default: name_asc
        - name: limit
          in: query
          description: Number of results to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
        - name: offset
          in: query
          description: Number of results to skip
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Successful search results
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
            X-RateLimit-Remaining:
              schema:
                type: integer
            X-RateLimit-Reset:
              schema:
                type: integer
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlaceDetail'
                  count:
                    type: integer
                    description: Number of results in this response
                  total:
                    type: integer
                    description: Total number of matching places
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/filters:
    get:
      summary: Get available filter options
      description: |
        Retrieve all available values for filter parameters (provinces, types, jurisdictions, themes).
        Useful for building filter UIs.

        ## Example Usage

        **JavaScript**:
        ```javascript
        const response = await fetch('https://historicplaces2.workers.dev/api/filters?lang=en');
        const data = await response.json();
        console.log('Provinces:', data.provinces);
        console.log('Types:', data.types);
        ```

        **Python**:
        ```python
        import requests
        response = requests.get('https://historicplaces2.workers.dev/api/filters', params={'lang': 'en'})
        data = response.json()
        print('Provinces:', data['provinces'])
        ```

        **cURL**:
        ```bash
        curl "https://historicplaces2.workers.dev/api/filters?lang=en"
        ```
      tags:
        - Metadata
      parameters:
        - name: lang
          in: query
          description: Language for content
          required: false
          schema:
            type: string
            enum: [en, fr]
            default: en
      responses:
        '200':
          description: Successful response with filter options
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
            X-RateLimit-Remaining:
              schema:
                type: integer
            X-RateLimit-Reset:
              schema:
                type: integer
          content:
            application/json:
              schema:
                type: object
                properties:
                  provinces:
                    type: array
                    items:
                      type: object
                      properties:
                        province:
                          type: string
                        count:
                          type: integer
                  types:
                    type: array
                    items:
                      type: object
                      properties:
                        recognition_type:
                          type: string
                        count:
                          type: integer
                  jurisdictions:
                    type: array
                    items:
                      type: object
                      properties:
                        jurisdiction:
                          type: string
                        count:
                          type: integer
                  themes:
                    type: array
                    items:
                      type: object
                      properties:
                        theme:
                          type: string
                        count:
                          type: integer
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/map:
    get:
      summary: Get places for map display
      description: |
        Retrieve places with geographic coordinates, optimized for map visualizations.
        Optionally filter by geographic bounds.

        ## Example Usage

        **JavaScript (Leaflet Map)**:
        ```javascript
        // Get visible map bounds
        const bounds = map.getBounds();
        const boundsStr = `${bounds.getSouth()},${bounds.getWest()},${bounds.getNorth()},${bounds.getEast()}`;

        const response = await fetch(`https://historicplaces2.workers.dev/api/map?lang=en&bounds=${boundsStr}`);
        const data = await response.json();

        // Add markers to map
        data.places.forEach(place => {
          L.marker([place.latitude, place.longitude])
            .bindPopup(place.name)
            .addTo(map);
        });
        ```

        **Python**:
        ```python
        import requests
        response = requests.get('https://historicplaces2.workers.dev/api/map', params={
            'lang': 'en',
            'bounds': '45.0,-76.0,46.0,-75.0'  # Ottawa area
        })
        data = response.json()
        print(f"Found {data['count']} places in bounds")
        ```

        **cURL**:
        ```bash
        curl "https://historicplaces2.workers.dev/api/map?lang=en&bounds=45.0,-76.0,46.0,-75.0"
        ```
      tags:
        - Geography
      parameters:
        - name: lang
          in: query
          description: Language for content
          required: false
          schema:
            type: string
            enum: [en, fr]
            default: en
        - name: bounds
          in: query
          description: Geographic bounds in format "minLat,minLng,maxLat,maxLng"
          required: false
          schema:
            type: string
            example: "45.0,-76.0,46.0,-75.0"
      responses:
        '200':
          description: Successful response with map data
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
            X-RateLimit-Remaining:
              schema:
                type: integer
            X-RateLimit-Reset:
              schema:
                type: integer
          content:
            application/json:
              schema:
                type: object
                properties:
                  places:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlaceLocation'
                  count:
                    type: integer
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/provinces:
    get:
      summary: List provinces with place counts
      description: |
        Get a list of all Canadian provinces/territories with the number of historic places in each.

        ## Example Usage

        **JavaScript**:
        ```javascript
        const response = await fetch('https://historicplaces2.workers.dev/api/provinces?lang=en');
        const data = await response.json();
        data.provinces.forEach(p => {
          console.log(`${p.province}: ${p.count} places`);
        });
        ```

        **Python**:
        ```python
        import requests
        response = requests.get('https://historicplaces2.workers.dev/api/provinces', params={'lang': 'en'})
        data = response.json()
        for p in data['provinces']:
            print(f"{p['province']}: {p['count']} places")
        ```

        **cURL**:
        ```bash
        curl "https://historicplaces2.workers.dev/api/provinces?lang=en"
        ```
      tags:
        - Geography
      parameters:
        - name: lang
          in: query
          description: Language for content
          required: false
          schema:
            type: string
            enum: [en, fr]
            default: en
      responses:
        '200':
          description: Successful response with province list
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
            X-RateLimit-Remaining:
              schema:
                type: integer
            X-RateLimit-Reset:
              schema:
                type: integer
          content:
            application/json:
              schema:
                type: object
                properties:
                  provinces:
                    type: array
                    items:
                      type: object
                      properties:
                        province:
                          type: string
                        count:
                          type: integer
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/stats:
    get:
      summary: Get database statistics
      description: |
        Retrieve overall statistics about the historic places database.

        ## Example Usage

        **JavaScript**:
        ```javascript
        const response = await fetch('https://historicplaces2.workers.dev/api/stats?lang=en');
        const data = await response.json();
        console.log(`Total places: ${data.totalPlaces}`);
        console.log(`Total images: ${data.totalImages}`);
        ```

        **Python**:
        ```python
        import requests
        response = requests.get('https://historicplaces2.workers.dev/api/stats', params={'lang': 'en'})
        data = response.json()
        print(f"Total places: {data['totalPlaces']}")
        print(f"Total images: {data['totalImages']}")
        ```

        **cURL**:
        ```bash
        curl "https://historicplaces2.workers.dev/api/stats?lang=en"
        ```
      tags:
        - Metadata
      parameters:
        - name: lang
          in: query
          description: Language for content
          required: false
          schema:
            type: string
            enum: [en, fr]
            default: en
      responses:
        '200':
          description: Successful response with statistics
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
            X-RateLimit-Remaining:
              schema:
                type: integer
            X-RateLimit-Reset:
              schema:
                type: integer
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalPlaces:
                    type: integer
                    description: Total number of historic places
                  placesWithCoordinates:
                    type: integer
                    description: Number of places with lat/lng data
                  provinces:
                    type: integer
                    description: Number of provinces/territories represented
                  totalImages:
                    type: integer
                    description: Total number of images
                  themes:
                    type: integer
                    description: Number of unique historical themes
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  schemas:
    PlaceSummary:
      type: object
      description: Basic information about a historic place
      properties:
        id:
          type: integer
          description: Unique place identifier
        name:
          type: string
          description: Name of the historic place
        province:
          type: string
          description: Canadian province or territory
        municipality:
          type: string
          description: City or town
        latitude:
          type: number
          format: double
          nullable: true
        longitude:
          type: number
          format: double
          nullable: true
        recognition_type:
          type: string
          description: Type of historic recognition
        jurisdiction:
          type: string
          description: Level of government jurisdiction
        primary_image:
          type: string
          format: uri
          nullable: true
          description: URL of primary image

    PlaceDetail:
      type: object
      description: Detailed information about a historic place
      properties:
        id:
          type: integer
        name:
          type: string
        province:
          type: string
        municipality:
          type: string
        latitude:
          type: number
          format: double
          nullable: true
        longitude:
          type: number
          format: double
          nullable: true
        description:
          type: string
          description: Full text description of the place
        recognition_type:
          type: string
        jurisdiction:
          type: string
        recognition_date:
          type: string
          description: Date of historic recognition
        architect:
          type: string
          nullable: true
          description: Name of architect(s)
        language:
          type: string
          enum: [en, fr]

    PlaceLocation:
      type: object
      description: Minimal place data for map display
      properties:
        id:
          type: integer
        name:
          type: string
        province:
          type: string
        municipality:
          type: string
        latitude:
          type: number
          format: double
        longitude:
          type: number
          format: double

    Image:
      type: object
      description: Image associated with a historic place
      properties:
        r2_url:
          type: string
          format: uri
          description: URL of the image in R2 storage
        alt:
          type: string
          description: Alt text for accessibility
        title:
          type: string
          nullable: true
          description: Image title or caption

    Error:
      type: object
      description: Error response
      properties:
        error:
          type: string
          description: Error type
        message:
          type: string
          description: Human-readable error message
        retryAfter:
          type: integer
          description: Seconds to wait before retrying (for 429 errors)

  responses:
    RateLimitExceeded:
      description: Rate limit exceeded
      headers:
        X-RateLimit-Limit:
          schema:
            type: integer
          description: Maximum requests per minute
        X-RateLimit-Remaining:
          schema:
            type: integer
          description: Always 0 for rate limit errors
        X-RateLimit-Reset:
          schema:
            type: integer
          description: Unix timestamp when rate limit resets
        Retry-After:
          schema:
            type: integer
          description: Seconds to wait before retrying
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Rate limit exceeded"
            message: "Too many requests. Please try again later."
            retryAfter: 60

    InternalServerError:
      description: Internal server error
      headers:
        X-RateLimit-Limit:
          schema:
            type: integer
        X-RateLimit-Remaining:
          schema:
            type: integer
        X-RateLimit-Reset:
          schema:
            type: integer
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Internal server error"
            message: "An unexpected error occurred"
